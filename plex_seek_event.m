function [timestamp, dataword] = plex_seek_event(fid, header, ch, data)% function [timestamp, dataword] = plex_seek_event(fid, header, event, [data])%% Advances filepointer to the sought event. %% INPUT: %	fid -- file to search%	header: this is previously read from the file.%	event: event number (257 for strobed, 258 for start, 259 for stop)%	data: (for strobe event only) the data word sought; if omitted, look for any strobed data.%% OUTPUT:%	timestamp -- time of occurrence of event or -1 if EOF%	dataword -- for strobed data, contains the data word.%if nargin < 3	error('No event specified');endif fid == -1	error('Invalid file');end% read file headerfreq = header(35);  % frequencyndsp = header(36);  % number of dsp channelsnevents = header(37); % number of external eventsnslow = header(38);  % number of slow channelsnpw = header(39);  % number of points in wavenpr = header(40);  % number of points before thresholddataword = nan;timestamp = -1;% read the datawhile feof(fid) == 0	type = fread(fid, 1, 'int16');	upperbyte = fread(fid, 1, 'int16');	ts = fread(fid, 1, 'int32');	channel = fread(fid, 1, 'int16');	unit = fread(fid, 1, 'int16');	nwf = fread(fid, 1, 'int16');	nwords = fread(fid, 1, 'int16');	toread = nwords;	if toread > 0	  wf = fread(fid, toread, 'int16');	end   	if type == 4         if channel == ch			timestamp = ts ./ freq;			dataword = unit;			if ch ~= 257 | (ch == 257 & (nargin < 4 | isempty(data) | data == dataword))				return			else				timestamp = -1;				dataword = nan;			end      	end   	endend