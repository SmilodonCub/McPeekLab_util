% trial_align2.m% function aligned_data = trial_align2(data, align_index, align_limits)% new alignment code: aligns single data channel from single trial% data: input vector% align_index: index of state shift% align_limits: desired plotting time limits% JBB 1/21/04, 1/30/04function aligned_data = trial_align2(data, align_index, align_limits)% initialize aligned dataa_length = diff(align_limits);aligned_data = repmat(NaN, a_length, 1);% return NaN array if user attempts to align on nonexistent stateif isnan(align_index),	returnend% start indices for alignmento_length = length(data);o_start = align_index + align_limits(1) + 1;a_start = -o_start;% keep in boundso_start = max(1, o_start);a_start = max(1, a_start);% end indices for alignmento_end = align_index + align_limits(2);o_end = min(o_length, o_end);a_end = a_start + (o_end - o_start);% alignment operationaligned_data(a_start : a_end) = data(o_start : o_end);